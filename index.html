<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Voucher Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== GLOBAL STYLES ===== */
body {
  font-family: 'Comic Sans MS', 'Segoe UI', sans-serif;
  background: #ffe6f0;
  margin: 0;
  padding: 15px;
  color: #333;
}

.card {
  background: #fff0f6;
  border-radius: 20px;
  padding: 20px;
  max-width: 450px;
  margin: 15px auto;
  text-align: center;
  box-shadow: 0 4px 15px rgba(255,105,180,0.3);
  animation: pop 0.6s ease;
}

@keyframes pop {
  0% { transform: scale(0.9); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

h2 { color: #ff66b2; font-size: 24px; margin-bottom: 15px; }
h3 { color: #ff3399; font-size: 20px; margin: 10px 0; }

button {
  width: 100%;
  max-width: 300px;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  background: linear-gradient(45deg, #ff99cc, #ff66b2);
  color: white;
  transition: transform 0.2s, box-shadow 0.2s;
}

button:hover { transform: scale(1.05); box-shadow: 0 0 15px #ff66b2; }
.secondary-btn { background: linear-gradient(45deg, #ffb3d9, #ff99cc); }

input {
  width: 95%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 10px;
  border: 1px solid #ff66b2;
  outline: none;
  font-size: 16px;
  background: #fff0f6;
  color: #333;
}

input::placeholder { color: #ff66b2; }

.order-box {
  border: 1px solid #ff99cc;
  padding: 12px;
  margin: 12px 0;
  border-radius: 15px;
  font-size: 16px;
  background: #fff0f6;
}

img { max-width: 100%; height: auto; border-radius: 10px; margin: 10px 0; }

.qr-link {
  color: #ff3399;
  text-decoration: underline;
  font-weight: bold;
  font-size: 14px;
}
</style>
</head>
<body>
<div id="app"></div>

<script>
/* ===== DATA STORAGE ===== */
let orders = [];
let vouchersStock = { "70%": [], "73%": [] };
let archivedOrders = [];
const ADMIN_PASSWORD = "redoblado2019";

/* ===== INITIAL HOMEPAGE ===== */
function showHomepage(){
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>ðŸ’– Voucher Store ðŸ’–</h2>
      <button onclick="showBuyPage()">Buy Vouchers</button>
      <button onclick="showMyOrder()">Check My Order</button>
      <button onclick="showAdminLogin()" class="secondary-btn">Admin Panel</button>
    </div>
  `;
}

/* ===== BUY PAGE ===== */
function showBuyPage(){
  const stock70 = vouchersStock["70%"].length;
  const stock73 = vouchersStock["73%"].length;
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>ðŸ’– Buy Vouchers ðŸ’–</h2>
      <p><strong>70% Voucher - â‚±25</strong> | Stock: ${stock70}</p>
      <input type="number" id="qty70" placeholder="Quantity for 70%" min="0" oninput="calculateTotal()">
      <p><strong>73% Voucher - â‚±35</strong> | Stock: ${stock73}</p>
      <input type="number" id="qty73" placeholder="Quantity for 73%" min="0" oninput="calculateTotal()">
      <hr>
      <h3>Total: â‚±<span id="totalAmount">0</span></h3>
      <p><strong>Scan QR Code to Pay ðŸ’³</strong></p>
      <img src="https://i.imgur.com/VLM3sQK_d.jpeg" alt="GCash QR Code">
      <p class="qr-link">Link: <a href="https://i.imgur.com/VLM3sQK_d.jpeg" target="_blank">https://i.imgur.com/VLM3sQK_d.jpeg</a></p>
      <input type="text" id="reference" placeholder="Enter GCash Reference Number">
      <button onclick="submitOrder()">Submit Order</button>
      <button onclick="showHomepage()" class="secondary-btn">Back</button>
      <div id="buyResult"></div>
    </div>
  `;
}

/* ===== TOTAL CALCULATION ===== */
function calculateTotal(){
  const qty70 = parseInt(document.getElementById("qty70").value) || 0;
  const qty73 = parseInt(document.getElementById("qty73").value) || 0;
  document.getElementById("totalAmount").innerText = qty70*25 + qty73*35;
}

/* ===== SUBMIT ORDER ===== */
function submitOrder(){
  const qty70 = parseInt(document.getElementById("qty70").value) || 0;
  const qty73 = parseInt(document.getElementById("qty73").value) || 0;
  const reference = document.getElementById("reference").value.trim();
  if(qty70 === 0 && qty73 === 0) return alert("Enter quantity.");
  if(reference.length<6) return alert("Invalid reference.");
  orders.push({ qty70, qty73, reference, status:"pending", assignedVouchers:{}, timestamp: Date.now() });
  document.getElementById("buyResult").innerHTML = `<p style="color:green;">Order submitted! Await admin confirmation.</p>`;
  showBuyPage(); // refresh stock display
}

/* ===== CHECK ORDER ===== */
function showMyOrder(){
  const reference = prompt("Enter reference number:");
  if(!reference) return;
  const order = orders.concat(archivedOrders).find(o => o.reference === reference);
  if(!order) return alert("Order not found.");
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>My Order</h2>
      <p>Status: ${order.status}</p>
      <p>70% Codes: ${(order.assignedVouchers["70%"] || []).join(", ") || "None"}</p>
      <p>73% Codes: ${(order.assignedVouchers["73%"] || []).join(", ") || "None"}</p>
      <button onclick="showHomepage()">Back</button>
    </div>
  `;
}

/* ===== ADMIN LOGIN ===== */
function showAdminLogin(){
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Admin Login</h2>
      <input type="password" id="adminPasswordInput" placeholder="Enter Password">
      <button onclick="adminLogin()">Login</button>
      <button onclick="showHomepage()" class="secondary-btn">Back</button>
      <div id="adminLoginResult"></div>
    </div>
  `;
}

function adminLogin(){
  const pw = document.getElementById("adminPasswordInput").value;
  if(pw !== ADMIN_PASSWORD){ return alert("Incorrect password!"); }
  showAdminDashboard();
}

/* ===== ADMIN DASHBOARD ===== */
function showAdminDashboard(){
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Admin Panel</h2>
      <h3>Stock Vouchers</h3>
      <input type="text" id="stock70" placeholder="Add 70% codes (comma separated)">
      <button onclick="stockVouchers('70%')">Add 70%</button>
      <input type="text" id="stock73" placeholder="Add 73% codes (comma separated)">
      <button onclick="stockVouchers('73%')">Add 73%</button>
      <hr>
      <h3>Pending Orders</h3>
      <div id="ordersList"></div>
      <hr>
      <button onclick="showArchivedOrders()">View Archived Orders</button>
      <button onclick="showHomepage()" class="secondary-btn">Logout</button>
    </div>
  `;
  renderOrders();
}

/* ===== STOCK VOUCHERS ===== */
function stockVouchers(type){
  const inputId = type === "70%" ? "stock70" : "stock73";
  const raw = document.getElementById(inputId).value.trim();
  if(!raw) return alert("Enter voucher codes.");
  const codes = raw.split(",").map(c=>c.trim()).filter(c=>c);
  vouchersStock[type] = vouchersStock[type].concat(codes);
  alert(`Added ${codes.length} vouchers to ${type}`);
  document.getElementById(inputId).value = "";
  renderOrders();
}

/* ===== RENDER PENDING ORDERS ===== */
function renderOrders(){
  const container = document.getElementById("ordersList");
  if(!container) return;
  let html = "";
  orders.forEach((o,i)=>{
    if(o.status === "pending"){
      html += `
        <div class="order-box">
          <p>Ref: ${o.reference}</p>
          <p>Qty 70%: ${o.qty70} | Qty 73%: ${o.qty73}</p>
          <button onclick="confirmOrder(${i})">Confirm Order</button>
        </div>
      `;
    }
  });
  container.innerHTML = html || "<p>No pending orders.</p>";
}

/* ===== CONFIRM ORDER ===== */
function confirmOrder(index){
  const order = orders[index];
  if(order.qty70 > vouchersStock["70%"].length || order.qty73 > vouchersStock["73%"].length){
    return alert("Not enough vouchers in stock!");
  }
  // Assign vouchers
  order.assignedVouchers["70%"] = vouchersStock["70%"].splice(0, order.qty70);
  order.assignedVouchers["73%"] = vouchersStock["73%"].splice(0, order.qty73);
  order.status = "confirmed";
  // Move to archive
  archivedOrders.push(order);
  orders.splice(index, 1);
  alert(`Order confirmed! Vouchers assigned to buyer.`);
  showAdminDashboard();
}

/* ===== VIEW ARCHIVED ORDERS ===== */
function showArchivedOrders(){
  let html = "<div class='card'><h2>Archived Orders</h2>";
  archivedOrders.forEach((o,i)=>{
    html += `
      <div class="order-box">
        <p>Ref: ${o.reference}</p>
        <p>Status: ${o.status}</p>
        <p>70% Codes: ${(o.assignedVouchers["70%"]||[]).join(", ") || "None"}</p>
        <p>73% Codes: ${(o.assignedVouchers["73%"]||[]).join(", ") || "None"}</p>
        <button onclick="deleteArchived(${i})">Delete Permanently</button>
      </div>
    `;
  });
  html += `<button onclick="showAdminDashboard()" class="secondary-btn">Back</button></div>`;
  document.getElementById("app").innerHTML = html;
}

/* ===== DELETE ARCHIVED ORDER ===== */
function deleteArchived(i){
  archivedOrders.splice(i,1);
  showArchivedOrders();
}

/* ===== INITIALIZE ===== */
window.showHomepage = showHomepage;
window.showBuyPage = showBuyPage;
window.showMyOrder = showMyOrder;
window.showAdminLogin = showAdminLogin;

showHomepage();
</script>
</body>
</html>
